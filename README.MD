# Программа для загрузки отчетов с сайта АТС (персональных и публичных)

Программа позволяет скачивать и распределять по заданным папкам отчеты с сайта АО "АТС" (<https://www.atsenergo.ru/>). Отчеты могут скачиваться с публичных страниц сайта, так и из персонального раздела участника оптового рынка электроэнергии и мощности.

Программа работает в режиме командной строки.
Настройки загрузик отчетов необходимо указать в файлах ReportSettingsPart.xml (для персональных отчетов участников) и ReportSettingsPubl.xml (для публичных отчетов)

## Синтаксис:
```BASH
python main.py параметр=значение
```

Ключи:
+ `--user-pass`
Если указать данный ключ, то программа запрашивает пароль текущего пользователя и сохраняет его в keyring (для дальнейшей рассылки уведомлений по электронной почте).

   Пример: `python main.py --user-pass`

+ `--participant-pass=[код участника]`
Если указать данный ключ, то программа запрашивает пароль для данного кода участника и сохраняет его в `keyring` (для дальнейшей авторизации на сайте АТС). Код участника здесь - 8-мибуквенный код, который выдается участнику оптового рынка электроэнергии и мощности при его регистрации в торговой системе. Если код не будет указан, то программа сможет скачивать только публичные отчеты.

   Пример: `python main.py --participant-pass=XXXENERG`

Виды параметров:
+ `overwrite=true|false`
Параметр определяет, нужно перезаписывать уже существующие на диске файлы отчетов или нет.
По умолчанию `overwrite=false`

+ `dt=YYYYMMDD`
 (например `dt=20210910`)
Параметр задает загрузку отчетов только за одну конкретную дату.

+ `dt1=YYYYMMDD` (например `dt1=20210910`) или `dt1=-x` (например `dt1=-10`)
Загрузка отчетов с даты `dt1` до даты `dt2` (если она задана в параметрах) либо до текущей даты (если `dt2` не задана).
Параметр может задаваться в виде конкретной даты в формате `YYYYMMDD` либо со смещением влево на x дней.

+ `dt2=YYYYMMDD` (например `dt=20210910`)
Загрузка отчетов до даты `dt2`
По умолчанию `dt2` равен текущей дате

+ `load_type=private|public`
Загрузка персональных либо публичных отчетов.
По умолчанию `load_type=private`

+ `partcode=[Код участника]` (например `partcode=XXXENERG`)
Код участника для загрузки
Можно коды задавать через запятую, например `partcode=XXXENERG,XXXENER2,XXXENER3`.
Если не задан, то грузятся все участники, которые прописаны в настройках

+ `reportcode=[Код отчета]` (например `reportcode=carana_sell_units`)
Код отчета для загрузки. Можно задать несколько через запятую.
Если не задан, то грузятся все отчеты, которые имеются в настройках.
## Примеры
- `python main.py dt1=-5 source_type=ats_reports overwrite=false reportcode=cfrliab,mtrx,PENYLIAB,cfrliabdpg,peny_uved,CFR_PART_BUH_INFO,CFR_PART_LIAB_DEL_NOTICE,cessinfo,komreestr,CFR_PART_DPMV_NOTICE,CFR_RD_CLOSE_NOTIF,necessity`
   
   В этом примере загружаются персональные (не указан ключ `load_type`) отчеты по всем участникам, указанным в файле с настройками участников (т.к. конкретный участник не указан в ключе `partcode`). Отчеты загружаются за 5 прошедших дней с даты загрузки (`dt1=-5`)
   
   Если отчет есть, то он не перезаписывается (`overwrite=false`). 
   
   Коды загружаемых отчетов перечислены в ключе `reportcode` (cfrliab, mtrx, PENYLIAB,cfrliabdpg, peny_uved, CFR_PART_BUH_INFO, CFR_PART_LIAB_DEL_NOTICE, cessinfo, komreestr, CFR_PART_DPMV_NOTICE, CFR_RD_CLOSE_NOTIF, necessity)


## Лог
Логирование осуществляется в файл "LOG\py_ats.log"

Пример, как можно прочесть лог в powershell:
1) список загруженных файлов за 17.07.2022
```PS
Select-string "Log\py_ats.log" -Pattern "2022-07-17.+file"
```
2) список ошибок в июле 2022 года
```PS
Select-string "Log\py_ats.log" -Pattern "2022-07-.+error"
```
3) время загрузки
```PS
Select-string "Log\py_ats.log" -Pattern "complete"
```